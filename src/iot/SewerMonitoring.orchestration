{"global":{"id":0,"initial":false,"name":"Always","rules":[{"actions":[],"id":0}]},"properties":{},"states":[{"id":1,"initial":true,"name":"Normal","rules":[{"actions":[{"stateId":2,"type":"ChangeState"}],"condition":"SewerTelemetryData__e.Level__c >= OVERFLOW_THRESHOLD && SewerTelemetryData__e.Level__c <= WARNING_THRESHOLD","description":"If the level is greater than overflow threshold and less than Warning threshold, then transition to Warning state.","id":0,"when":{"eventSource":"SewerTelemetryData__e","type":"Event"}},{"actions":[{"stateId":3,"type":"ChangeState"}],"condition":"SewerTelemetryData__e.Level__c < OVERFLOW_THRESHOLD","description":"If the Level is less than overflow threshold then transition to Critical State","id":1,"when":{"eventSource":"SewerTelemetryData__e","type":"Event"}},{"actions":[{"fieldAssignments":[{"field":"Status","value":"\"Normal\""}],"id":0,"isResponseIngested":false,"label":"Update Asset Status to Normal","name":"Edit","recordFilters":[{"field":"Id","value":"Asset.Id"}],"responseEventName":"","salesforceObjectApiName":"Asset","type":"SalesforceOutputAction"}],"condition":"","description":"Update Asset Status to Normal and close all Drain overflow Open Cases for this Asset","id":2,"when":{"type":"Immediately"}}]},{"color":"#ffb758","id":2,"initial":false,"name":"Warning","rules":[{"actions":[{"stateId":1,"type":"ChangeState"}],"condition":"SewerTelemetryData__e.Level__c > WARNING_THRESHOLD","description":"If the level is greater than Warning threshold than transition to Normal state","id":0,"when":{"eventSource":"SewerTelemetryData__e","type":"Event"}},{"actions":[{"stateId":3,"type":"ChangeState"}],"condition":"SewerTelemetryData__e.Level__c < OVERFLOW_THRESHOLD","description":"If the level is less than overflow threshold then transition to Critical state","id":1,"when":{"eventSource":"SewerTelemetryData__e","type":"Event"}},{"actions":[{"fieldAssignments":[{"field":"Status","value":"\"Warning\""}],"id":0,"isResponseIngested":false,"label":"Update Asset Status to Warning","name":"Edit","recordFilters":[{"field":"Id","value":"Asset.Id"}],"responseEventName":"","salesforceObjectApiName":"Asset","type":"SalesforceOutputAction"}],"condition":"","description":"","id":2,"when":{"type":"Immediately"}}]},{"color":"#cc1010","id":3,"initial":false,"name":"Critical","rules":[{"actions":[{"stateId":2,"type":"ChangeState"}],"condition":"SewerTelemetryData__e.Level__c >= OVERFLOW_THRESHOLD && SewerTelemetryData__e.Level__c <= WARNING_THRESHOLD","description":"If the level is greater than overflow threshold and less than warning threshold than transition to Warning state.","id":0,"when":{"eventSource":"SewerTelemetryData__e","type":"Event"}},{"actions":[{"stateId":1,"type":"ChangeState"}],"condition":"SewerTelemetryData__e.Level__c > WARNING_THRESHOLD","description":"If the level is greater than warning threshold then transition to Normal state","id":1,"when":{"eventSource":"SewerTelemetryData__e","type":"Event"}},{"actions":[{"fieldAssignments":[{"field":"AccountId","value":"Asset.Account.Id"},{"field":"AssetId","value":"Asset.Id"},{"field":"Subject","value":"\"Critical level detected by \"  + Asset.Name + \" (\" + Asset.DeviceSerialNumber__c + \")\""},{"field":"Description","value":"\"This sewer is about to overflow. Current level is \" + TEXT(CurrentLevel)"},{"field":"ContactId","value":"Asset.Contact.Id"},{"field":"Priority","value":"\"High\""},{"field":"Type","value":"\"DO\""},{"field":"Status","value":"\"New\""},{"field":"Origin","value":"\"Web\""}],"id":0,"isResponseIngested":false,"label":"Create Case","name":"Create","recordFilters":[],"responseEventName":"","salesforceObjectApiName":"Case","type":"SalesforceOutputAction"},{"fieldAssignments":[{"field":"Status","value":"\"Critical\""}],"id":1,"isResponseIngested":false,"label":"Update Asset Status to Critical","name":"Edit","recordFilters":[{"field":"Id","value":"Asset.Id"}],"responseEventName":"","salesforceObjectApiName":"Asset","type":"SalesforceOutputAction"}],"condition":"","description":"Create a Case and assign it to a specific queue.\nRaise a Platform event so that control pumps can turn on automatically.\nUpdate Asset status to Critical.","id":2,"when":{"type":"Immediately"}}]}],"variables":[{"condition":"","dataType":"Number","description":"","eventSource":"","id":0,"initialValue":"12","name":"WARNING_THRESHOLD"},{"condition":"","dataType":"Number","description":"","eventSource":"","id":1,"initialValue":"8","name":"OVERFLOW_THRESHOLD"},{"condition":"","dataType":"Number","description":"","eventSource":"SewerTelemetryData__e","id":2,"initialValue":"0","name":"CurrentLevel","value":{"formula":"SewerTelemetryData__e.Level__c","type":"Custom"}}]}